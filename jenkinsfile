node{
   stage('SCM checkout'){
    
    git 'https://github.com/kaifakh22/my-app-jenkinsfile.git'
   }
   stage('compile-package')
   {
    def mvnHome = tool name: 'Maven 3.8.5', type: 'maven'
    sh "${mvnHome}/bin/mvn package"
   }
   stage('Sonarqube Analysis'){
     environment {
        scannerHome = tool 'sonar-scanner-4.7.0'
     }
     def SCANNER_HOME = tool name: 'sonar-scanner-4.7.0', type: 'hudson.plugins.sonar.SonarRunnerInstallation'
     def mvnHome = tool name: 'Maven 3.8.5', type: 'maven'
     withSonarQubeEnv(installationName: 'sonar-9', credentialsId: 'sonar-aws-docker') {
       //sh "${mvnHome}/bin/mvn sonar:sonar"
       sh 'echo "Print scanner home"'
       sh 'echo $SCANNER_HOME'
       sh '''$scannerHome/bin/sonar-scanner  \
         sonar.projectKey=jenkins_pipeline \
         sonar.projectName=jenkins_pipeline \
         sonar.projectVersion=1.0 \
         sonar.sourceEncoding=UTF-8 \
         sonar.language=java \
         sonar.sources=/var/lib/jenkins/workspace/$JOB_NAME \
         sonar.sources=src/main/java/  \
         sonar.host.url=http://3.110.197.157:9000/'''
     }
   }
   stage('Email Notification'){
     mail bcc: '', body: '''Hi,This email is from jenkins pipeline job''', cc: '', from: 'awscloud.akhtar@gmail.com', replyTo: '', subject: 'Jenkins pipeline job', to: 'awscloud.akhtar@gmail.com'
   }
    

}
